<html>
<head>
<title>Callback Hook System</title>
<link rel="stylesheet" type="text/css" href="../media/style.css">
</head>
<body>

<table border="0" cellspacing="0" cellpadding="0" height="48" width="100%">
  <tr>
    <td class="header_top">Cgiapp2</td>
  </tr>
  <tr><td class="header_line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
  <tr>
    <td class="header_menu">
  		  [ <a href="../classtrees_Cgiapp2.html" class="menu">class tree: Cgiapp2</a> ]
		  [ <a href="../elementindex_Cgiapp2.html" class="menu">index: Cgiapp2</a> ]
		  [ <a href="../elementindex.html" class="menu">all elements</a> ]
    </td>
  </tr>
  <tr><td class="header_line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
</table>

<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="200" class="menu">
	<div id="ric">
					<p><a href="../ric_Changelog.html">Changelog</a></p>
					<p><a href="../ric_README.html">README</a></p>
			</div>
      <b>Packages:</b><br />
              <a href="../li_Cgiapp2.html">Cgiapp2</a><br />
            <br /><br />
		<b>Tutorials/Manuals:</b><br />
							<strong>Class-level:</strong>
							<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp2.cls.html">Introduction</a>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp21.cls.html">Usage Example</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp22.cls.html">Abstract</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp23.cls.html">Purpose and Conventions</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp24.cls.html">Callback Hook System</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp25.cls.html">Exception and Error Handling</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp26.cls.html">Types of Methods</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp27.cls.html">Template Engine Interface</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp28.cls.html">Migrating from Cgiapp to Cgiapp2</a>
</ul>
<ul>
	<li type="square"><a href="../Cgiapp2/tutorial_Cgiapp29.cls.html">Resources and Credits</a>
</ul>
</li></ul>

							                        <b>Files:</b><br />
      	  <div class="package">
			<a href="../Cgiapp2/_Cgiapp2_class_php.html">		Cgiapp2.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Error_class_php.html">		Error.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Exception_Error_class_php.html">		Error.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Exception_class_php.html">		Exception.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_FrontController_class_php.html">		FrontController.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Plugin_Template_Interface_class_php.html">		Interface.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Error_Observer_Interface_class_php.html">		Interface.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Exception_Observer_Interface_class_php.html">		Interface.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Exception_Observer_Log_class_php.html">		Log.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Error_Observer_Log_class_php.html">		Log.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Exception_Observer_Mail_class_php.html">		Mail.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Error_Observer_Mail_class_php.html">		Mail.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Plugin_Savant2_class_php.html">		Savant2.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Plugin_Savant3_class_php.html">		Savant3.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Plugin_Smarty_class_php.html">		Smarty.class.php
		</a><br>
			<a href="../Cgiapp2/_Cgiapp2_Plugin_Xslt_class_php.html">		Xslt.class.php
		</a><br>
	  </div><br />
      
            <b>Classes:</b><br />
        <div class="package">
		    		<a href="../Cgiapp2/Cgiapp2.html">Cgiapp2</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Error.html">Cgiapp2_Error</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Error_Observer_Interface.html">Cgiapp2_Error_Observer_Interface</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Error_Observer_Log.html">Cgiapp2_Error_Observer_Log</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Error_Observer_Mail.html">Cgiapp2_Error_Observer_Mail</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Exception.html">Cgiapp2_Exception</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Exception_Error.html">Cgiapp2_Exception_Error</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Exception_Observer_Interface.html">Cgiapp2_Exception_Observer_Interface</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Exception_Observer_Log.html">Cgiapp2_Exception_Observer_Log</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Exception_Observer_Mail.html">Cgiapp2_Exception_Observer_Mail</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_FrontController.html">Cgiapp2_FrontController</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Plugin_Savant2.html">Cgiapp2_Plugin_Savant2</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Plugin_Savant3.html">Cgiapp2_Plugin_Savant3</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Plugin_Smarty.html">Cgiapp2_Plugin_Smarty</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Plugin_Template_Interface.html">Cgiapp2_Plugin_Template_Interface</a><br />
	    		<a href="../Cgiapp2/Cgiapp2_Plugin_Xslt.html">Cgiapp2_Plugin_Xslt</a><br />
	  </div>
                </td>
    <td>
      <table cellpadding="10" cellspacing="0" width="100%" border="0"><tr><td valign="top">

<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="10%" align="left" valign="bottom"><a href=
"../Cgiapp2/tutorial_Cgiapp23.cls.html">Prev</a></td>
<td width="80%" align="center" valign="bottom"></td>
<td width="10%" align="right" valign="bottom"><a href=
"../Cgiapp2/tutorial_Cgiapp25.cls.html">Next</a></td>
</tr>
</table>
<div><a name=""></a><div class="ref-title-box">Callback Hook System<h1 class="ref-title">Callback Hook System</h1></div>

<span><a name=""></a><h2 class="title">Introduction and Purpose</h2><p>Version 2.0.0 of Cgiapp2 introduces the callback hook system. This was
        originally introduced to CGI::Application during the fall of 2004 to
        provide even more flexibility to the already flexible CGI::Application;
        standard plugins for handling things such as authorization, form
        validation, and other template engines can then be developed and plugged
        into an application at specific points of execution to speed development
        and also to prevent the need to rewrite superclasses.</p>
    <p>The callback hook system implements a classic observer pattern. The
        object class becomes the subject, and the 
        <a href="../Cgiapp2/Cgiapp2.html#methodcall_hook">call_hook()</a> method is used to notify
        observers. The 'hook' argument to 
        <a href="../Cgiapp2/Cgiapp2.html#methodcall_hook">call_hook()</a> indicates the event that has
        been triggered, which in turn selects which observers to notify. All
        observers are passed an object instance of the observable class in order
        to effect its modification.</p></span>

<span><a name=""></a><h2 class="title">Callback Hooks</h2><p>There are several pre-installed Cgiapp2::$_INSTALLED_HOOKS
        you may tie into. These include:</p>
    <li><strong>init</strong> - called during object
            instantiation, just prior to execution of the <a href="../Cgiapp2/Cgiapp2.html#methodsetup">            setup()</a> method. In your application class, 
            <a href="../Cgiapp2/Cgiapp2.html#methodcgiapp_init">cgiapp_init()</a> is automatically linked
            to this hook (if defined).</li>
        <li><strong>prerun</strong> - called just prior to run mode
            execution, and can change the selected run mode. In your application
            class, <a href="../Cgiapp2/Cgiapp2.html#methodcgiapp_prerun">cgiapp_prerun()</a> is
            automatically linked to this hook (if defined).</li>
        <li><strong>postrun</strong> - called after completion of the
            run mode, and can alter the content generated. In your application
            class, <a href="../Cgiapp2/Cgiapp2.html#methodcgiapp_postrun">cgiapp_postrun()</a> is
            automatically linked to this hook.</li>
        <li><strong>teardown</strong> - called at object destruction.
            In your application class, <a href="../Cgiapp2/Cgiapp2.html#methodteardown">teardown()</a> is
            automatically linked to this hook.</li>
        <li><strong>tmpl_path</strong> - called when setting a new
            template path. In your application class, you can simply call 
            <a href="../Cgiapp2/Cgiapp2.html#methodtmpl_path">tmpl_path()</a>, assuming you are using a
            template plugin that implements the hook.</li>
        <li><strong>tmpl_assign</strong> - called when assigning
            variables to a template. In your application class, you can simply
            call <a href="../Cgiapp2/Cgiapp2.html#methodtmpl_assign">tmpl_assign()</a>, assuming you are
            using a template plugin that implements the hook.</li>
        <li><strong>tmpl_fetch</strong> - called when loading a
            template (typically, fetching template contents). In your
            application class, you may simply call
            <a href="../Cgiapp2/Cgiapp2.html#methodload_tmpl">load_tmpl()</a>, assuming you are using a
            tmeplate plugin that implements the hook.</li>
    <p>You may also create your own hooks using 
        <a href="../Cgiapp2/Cgiapp2.html#methodnew_hook">new_hook()</a>, allowing other classes the
        ability to customize your application classes.</p>
    <p>To make use of the callback system, you must register callbacks with it.
        You do so with the <a href="../Cgiapp2/Cgiapp2.html#methodadd_callback">add_callback()</a> method,
        which allows you to register a callback with a hook; additionally, you
        can prioritize when it is executed by optionally providing a class with
        which to register it. Those hooks registered with the class of the
        current object instance are executed first, while those of the class'
        ancestors getting executed by order of ancestry.</p>
    <p>Template hooks (tmpl_path, tmpl_assign, and load_tmpl) are treated
        slightly differently. The author cannot think of a usage where having
        multiple template engines present would be a good idea. Additionally,
        load_tmpl should really only ever return a single string value. As such,
        the template hooks always register with the Cgiapp2 class, and each
        callback registered replaces any callbacks previously registered with
        that hook (i.e., only one callback is allowed per template hook).</p></span>

<span><a name=""></a><h2 class="title">API Summary</h2><li>Callback hooks receive at the minimum a single argument, as
            the first argument in the argument list: the object instance of the
            calling class (the observed object). (A small list of them have the
            object instance as the last argument; see API Details.)</li>
        <li>When multiple callbacks are called for a single hook, the
            return values are returned as an array, each item representing the
            return value of a single callback. Otherwise the return value of the
            sole callback will be returned.</li></span>

<span><a name=""></a><h2 class="title">API Details</h2><p>All callback hooks are passed at the minimum a single argument, the
        object instance of the calling class (the observed object). Some hooks
        take additional arguments:</p>
    <li><strong>init</strong> is passed all arguments that were
        passed to <a href="../Cgiapp2/Cgiapp2.html#method__construct">the constructor</a>; these are a
        single array, and constitute the second argument to the hook.</li>
        <li><strong>prerun</strong> is passed the requested run mode
        as the second argument to the hook.</li>
        <li><strong>postrun</strong> is passed the content generated
        by the run mode as the second argument to the hook.</li>
        <li><strong>tmpl_path</strong> is passed the template path as
        the second argument, and any extra parameters for the template engine as
        an associative array in the third argument.</li>
        <li><strong>tmpl_assign</strong> may be passed a variety of
        arguments; all arguments are passed on to the callback hook.</li>
        <li><strong>load_tmpl</strong> is passed the name of the
        template file as its second argument.</li>
    <p>Additionally, the object instance is typically passed as the first
        argument to a hook. However, there are some special cases where it is
        passed as the <strong>final</strong> argument:</p>
    <li>init</li>
        <li>prerun</li>
        <li>postrun</li>
    <p>Finally, all callbacks registered with 
        <a href="../Cgiapp2/Cgiapp2.html#methodadd_callback">add_callback()</a> must be valid PHP
        callbacks.</p></span>

<span><a name=""></a><h2 class="title">Examples</h2><p>Below are several examples of callback hooks in use. You may also want
        to see <a href="../Cgiapp2/Cgiapp2_Plugin_Smarty.html">Cgiapp2_Plugin_Smarty</a> for an example of a class that
        implements several callback hooks (the template callback hooks).</p></span>

<span><a name=""></a><h2 class="title">Example 1: Register a Callback with a Hook</h2><p>An example of how to register a callback:</p>
    <div class="listing"><pre><ol><li><span class="src-key">class </span><span class="src-id">SomeClass</span></li>
<li><span class="src-sym">{</span></li>
<li>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><span class="src-id">prerunHook</span><span class="src-sym">(</span><span class="src-var">$rm</span><span class="src-sym">, </span><span class="src-var">$cgiapp</span><span class="src-sym">)</span></li>
<li>    <span class="src-sym">{</span></li>
<li>        <span class="src-comm">// Don't allow access to admin mode unless user is admin</span></li>
<li>        <span class="src-key">if </span><span class="src-sym">((</span><span class="src-str">'admin' </span>!= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'username'</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li>            &amp;&amp; <span class="src-sym">(</span><span class="src-str">'admin' </span>== <span class="src-var">$rm</span><span class="src-sym">))</span></li>
<li>        <span class="src-sym">{</span></li>
<li>            <span class="src-var">$cgiapp</span><span class="src-sym">-&gt;</span><span class="src-id">prerun_mode</span><span class="src-sym">(</span><span class="src-str">'login'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>        <span class="src-sym">}}</span></li>
<li><span class="src-sym">}</span></li>
<li><span class="src-id"><a href="../Cgiapp2/Cgiapp2.html">Cgiapp2</a></span><span class="src-sym">::</span><a href="../Cgiapp2/Cgiapp2.html#methodadd_callback">add_callback</a><span class="src-sym">(</span><span class="src-str">'prerun'</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'SomeClass'</span><span class="src-sym">, </span><span class="src-str">'prerunHook'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-str">'MyCgiapp2'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
</ol></pre></div>
    <p>The above code creates a class, 'SomeClass', that registers a prerun
        hook with the class 'MyCgiapp2'. If certain conditions are met, it
        changes the run mode of MyCgiapp2 (or one of its descendents) to 'login'.</p></span>

<span><a name=""></a><h2 class="title">Example 2: Create and Implement a Custom Hook</h2><p>An example of how to create a new hook and register a callback with it:</p>
    <div class="listing"><pre><ol><li><span class="src-key">class </span><span class="src-id">SomeClass </span><span class="src-key">extends </span><a href="../Cgiapp2/Cgiapp2.html">Cgiapp2</a></li>
<li><span class="src-sym">{</span></li>
<li>    <span class="src-key">protected </span><span class="src-key">function </span><span class="src-id">cgiapp_init</span><span class="src-sym">(</span><span class="src-var">$args</span><span class="src-sym">, </span><span class="src-var">$cgiapp</span><span class="src-sym">)</span></li>
<li>    <span class="src-sym">{</span></li>
<li>        <span class="src-id">self</span><span class="src-sym">::</span><span class="src-id">new_hook</span><span class="src-sym">(</span><span class="src-str">'postTemplate'</span><span class="src-sym">, </span><span class="src-str">'SomeClass'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>    <span class="src-sym">}</span></li>
<li>&nbsp;</li>
<li>    <span class="src-comm">// some other stuff in between: setup(), run modes, etc.</span></li>
<li>&nbsp;</li>
<li>    </li>
<li>    <span class="src-key">protected </span><span class="src-key">function </span><span class="src-id">cgiapp_postrun</span><span class="src-sym">(</span><span class="src-var">$body</span><span class="src-sym">, </span><span class="src-var">$cgiapp</span><span class="src-sym">)</span></li>
<li>    <span class="src-sym">{</span></li>
<li>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">tmpl_assign</span><span class="src-sym">(</span><span class="src-str">'content'</span><span class="src-sym">, </span><span class="src-var">$body</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>        <span class="src-var">$body </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">load_tmpl</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">param</span><span class="src-sym">(</span><span class="src-str">'site_tmpl'</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li>        <span class="src-var">$body </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">call_hook</span><span class="src-sym">(</span><span class="src-str">'postTemplate'</span><span class="src-sym">, </span><span class="src-var">$body</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>        <span class="src-var">$cgiapp</span><span class="src-sym">-&gt;</span><span class="src-id">postrun_body</span><span class="src-sym">(</span><span class="src-var">$body</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>    <span class="src-sym">}</span></li>
<li><span class="src-sym">}</span></li>
<li>&nbsp;</li>
<li><span class="src-key">class </span><span class="src-id">postClass</span></li>
<li><span class="src-sym">{</span></li>
<li>    <span class="src-key">function </span><span class="src-id">tidy</span><span class="src-sym">(</span><span class="src-var">$cgiapp</span><span class="src-sym">, </span><span class="src-var">$body</span><span class="src-sym">)</span></li>
<li>    <span class="src-sym">{</span></li>
<li>        <span class="src-var">$tidy </span>= <span class="src-key">new </span><span class="src-id">tidy</span><span class="src-sym">;</span></li>
<li>        <span class="src-var">$tidy</span><span class="src-sym">-&gt;</span><span class="src-id">parseString</span><span class="src-sym">(</span><span class="src-var">$body</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>        <span class="src-var">$tidy</span><span class="src-sym">-&gt;</span><span class="src-id">cleanRepair</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li>&nbsp;</li>
<li>        <span class="src-key">return </span><span class="src-var">$body</span><span class="src-sym">;</span></li>
<li>    <span class="src-sym">}</span></li>
<li><span class="src-sym">}</span></li>
<li><span class="src-id"><a href="../Cgiapp2/Cgiapp2.html">Cgiapp2</a></span><span class="src-sym">::</span><a href="../Cgiapp2/Cgiapp2.html#methodadd_callback">add_callback</a><span class="src-sym">(</span><span class="src-str">'postTemplate'</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'postClass'</span><span class="src-sym">, </span><span class="src-str">'tidy'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-str">'SomeClass'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
</ol></pre></div>
    <p>The above code creates a class, 'SomeClass', that creates a
        'postTemplate' hook; this hook is then called in cgiapp_postrun() after
        assigning the run mode content to a sitewide template.</p>
    <p>A new class, postClass, implements a method 'tidy' that takes some text
        and runs it through tidy. It is then added as a callback to the
        'postTemplate' hook.</p>
    <p>In effect, 'SomeClass' has just added a hook for manipulating the final
        content of the application.</p></span>

<span><a name=""></a><h2 class="title">Included Plugins</h2><p>The Cgiapp2 distribution package includes a number of plugins ready for
        use:</p>
    <li><a href="../Cgiapp2/Cgiapp2_Plugin_Template_Interface.html">Cgiapp2_Plugin_Template_Interface</a>: an interface class
            for implementing template plugins. Plugins that conform to the
            interface can be used transparently via Cgiapp2's
            <a href="../Cgiapp2/Cgiapp2.html#methodtmpl_path">tmpl_path()</a>, 
            <a href="../Cgiapp2/Cgiapp2.html#methodtmpl_assign">tmpl_assign()</a>, and
            <a href="../Cgiapp2/Cgiapp2.html#methodload_tmpl">load_tmpl()</a> methods. This means that you
            can swap in any template plugin implementing the interface
            transparently to your application.</li>
        <li><a href="../Cgiapp2/Cgiapp2_Plugin_Smarty.html">Cgiapp2_Plugin_Smarty</a>: a template plugin implementing
            Cgiapp2_Plugin_Template_interface to provide the Smarty
            template engine.</li>
        <li><a href="../Cgiapp2/Cgiapp2_Plugin_Savant2.html">Cgiapp2_Plugin_Savant2</a>: a template plugin implementing
            Cgiapp2_Plugin_Template_interface to provide the Savant2
            template engine.</li>
        <li><a href="../Cgiapp2/Cgiapp2_Plugin_Savant3.html">Cgiapp2_Plugin_Savant3</a>: a template plugin implementing
            Cgiapp2_Plugin_Template_interface to provide the Savant3
            template engine.</li></span></div>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="../Cgiapp2/tutorial_Cgiapp23.cls.html">Prev</a></td>
<td width="34%" align="center" valign="top"><a href=
"../Cgiapp2/tutorial_Cgiapp2.cls.html">Up</a></td>
<td width="33%" align="right" valign="top"><a href=
"../Cgiapp2/tutorial_Cgiapp25.cls.html">Next</a></td>
</tr>

<tr>
<td width="33%" align="left" valign="top">Purpose and Conventions</td>
<td width="34%" align="center" valign="top">Introduction</td>
<td width="33%" align="right" valign="top">Exception and Error Handling</td>
</tr>
</table>
        <div class="credit">
		    <hr />
		    Documentation generated on Sat, 03 Jun 2006 10:48:28 -0400 by <a href="http://www.phpdoc.org">phpDocumentor 1.3.0RC5</a>
	      </div>
      </td></tr></table>
    </td>
  </tr>
</table>

</body>
</html>